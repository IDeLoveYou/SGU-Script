## ç›®å½•

*   [è¯´æ˜](#è¯´æ˜)

*   [ç»´æŠ¤è®¾å¤‡åˆ—è¡¨](#ç»´æŠ¤è®¾å¤‡åˆ—è¡¨)

*   [ä¸å»ºè®®ä½¿ç”¨è®¾å¤‡åˆ—è¡¨](#ä¸å»ºè®®ä½¿ç”¨è®¾å¤‡åˆ—è¡¨)

*   [ç¼–è¯‘æ•™ç¨‹](#ç¼–è¯‘æ•™ç¨‹)

    *   [æ³¨æ„](#æ³¨æ„)

    *   [ç¼–è¯‘å‘½ä»¤](#ç¼–è¯‘å‘½ä»¤)

    *   [äºŒæ¬¡ç¼–è¯‘](#äºŒæ¬¡ç¼–è¯‘)

    *   [macOS åŸç”Ÿç³»ç»Ÿè¿›è¡Œç¼–è¯‘](#macos-åŸç”Ÿç³»ç»Ÿè¿›è¡Œç¼–è¯‘)

*   [è­¦å‘Š](#è­¦å‘Š)

# å›ºä»¶åˆ†æ”¯

# è¯´æ˜

*   æ­¤åˆ†æ”¯ç”¨äºå­˜å‚¨ç¼–è¯‘çš„UA2Få›ºä»¶

*   æ„Ÿè°¢`coolsnowwolfå¤§ä½¬`æä¾›çš„openwrtæºç ä»¥åŠ`Zxillyå¤§ä½¬`çš„UA2Fæºç 

*   ç¼–è¯‘æ•™ç¨‹å‚è€ƒäº†`coolsnowwolfå¤§ä½¬`ä¸`Zxillyå¤§ä½¬`çš„æ•™ç¨‹

*   `ledeä»“åº“` <https://github.com/coolsnowwolf/lede>

*   `UA2Fä»“åº“` <https://github.com/Zxilly/UA2F>

*   `OpenWrt ç¼–è¯‘ä¸é˜²æ£€æµ‹éƒ¨ç½²æ•™ç¨‹` https://www.notion.so/sunbk201public/OpenWrt-f59ae1a76741486092c27bc24dbadc59

***

# ç»´æŠ¤è®¾å¤‡åˆ—è¡¨
ğŸ”” **æœ‰äº›è®¾å¤‡ç”±äºæ²¡æœ‰æœºå™¨æ‰€ä»¥æ²¡æœ‰è¿›è¡Œæµ‹è¯•ï¼Œæœ‰é—®é¢˜è¯·æissue**

| æœºå‹ | æ ‡ç­¾ | è‡ªç”¨ | æ˜¯å¦è¿›è¡Œæµ‹è¯• |
| :----: | :----: | :----: | :----: |
| æ–°è·¯ç”±3 | [d-team_newifi-d2](./ramips-mt7621-d-team_newifi-d2) | âœ… | âœ… |
| æ–è®¯K2 | [phicomm_psg1218a](./ramips-mt7620-phicomm_psg1218a) | â | âœ… |
| æ–è®¯K2C | [phicomm_psg1218b](./ramips-mt7620-phicomm_psg1218b) | â | â |
| æ–è®¯K2P | [phicomm_k2p](./ramips-mt7621-phicomm_k2p) | âœ… | âœ… |
| æå£¹S | [hiwifi_hc5661](./ramips-mt7620-hiwifi_hc5661) | â | âœ… |
| æè·¯ç”±2 | [hiwifi_hc5761](./ramips-mt7620-hiwifi_hc5761) | â | âœ… |
| æè·¯ç”±3 | [hiwifi_hc5861](./ramips-mt7620-hiwifi_hc5861) | â | âœ… |
| ä¼˜é…·è·¯ç”±å® | [youku_yk-l1](./ramips-mt7620-youku_yk-l1) | â |â |
| å°ç±³è·¯ç”±å™¨mini | [xiaomi_miwifi-mini](./ramips-mt7620-xiaomi_miwifi-mini) | â | â |

***

# ä¸å»ºè®®ä½¿ç”¨è®¾å¤‡åˆ—è¡¨

| æœºå‹ | åŸå›  |
| :----: | :----: |
| æå£¹S | æœ‰çº¿æ€§èƒ½è¿˜å¯ä»¥ï¼Œæ— çº¿æ€§èƒ½æ‹‰èƒ¯ |
| ä¼˜é…·è·¯ç”±å® | æ€§èƒ½å¤ªä½ï¼Œç¨³å®šæ€§è¾ƒå·®ï¼Œæ— çº¿æ€§èƒ½æ‹‰èƒ¯ |

***

# ç¼–è¯‘æ•™ç¨‹

## æ³¨æ„

1.  **ä¸è¦ç”¨ root ç”¨æˆ·è¿›è¡Œç¼–è¯‘**

2.  å›½å†…ç”¨æˆ·ç¼–è¯‘å‰æœ€å¥½å‡†å¤‡å¥½`ladder`

3.  è¯·ä¿è¯å…¨å±€`é­”æ³•`ç¯å¢ƒï¼Œç¼–è¯‘å¤±è´¥çš„å¤§å¤šæ•°åŸå› æ˜¯ç½‘ç»œé—®é¢˜

***

## ç¼–è¯‘å‘½ä»¤

1.  é¦–å…ˆè£…å¥½ Linux ç³»ç»Ÿï¼Œæ¨èDeepin ã€Debian 11 æˆ– Ubuntu LTS

2.  å®‰è£…ç¼–è¯‘ä¾èµ–

    ```bash
    # ç³»ç»Ÿæ›´æ–°
    sudo apt-get -y update
    sudo apt-get -y upgrade
    ```

    ```bash
    # å®‰è£…ä¾èµ–å…³ç³»
    sudo apt-get -y install build-essential asciidoc binutils bzip2 gawk gettext git libncurses5-dev libz-dev patch python3 python2.7 unzip zlib1g-dev lib32gcc1 libc6-dev-i386 subversion flex uglifyjs git-core gcc-multilib p7zip p7zip-full msmtp libssl-dev texinfo libglib2.0-dev xmlto qemu-utils upx libelf-dev autoconf automake libtool autopoint device-tree-compiler g++-multilib antlr3 gperf wget curl swig rsync
    ```

3.  ä¸‹è½½æºä»£ç ï¼Œæ›´æ–° feeds

    ```bash
    # ä¸‹è½½æºç  (ä¸‹é¢ä¸‰è€…é€‰å…¶ä¸€)
    git clone https://github.com/openwrt/openwrt.git
    git clone https://github.com/coolsnowwolf/lede
    git clone https://github.com/immortalwrt/immortalwrt.git
    cd openwrt/lede/immortalwrt
    ./scripts/feeds update -a
    ./scripts/feeds install -a
    
    ```
    
4. ä¿®æ”¹å†…æ ¸é…ç½®æ–‡ä»¶

   ```bash
   # æ–¹æ³•ä¸€
   ## åœ¨openwrtã€ledeæˆ–immortalwrtç›®å½•ä¸‹æ‰¾åˆ°target/linux/[target]/config-xxxæ–‡ä»¶
   ## [target]æ˜¯ä½ çš„è®¾å¤‡æ ‡ç­¾ï¼Œä¾‹å¦‚æ–°è·¯ç”±ä¸‰[ramips-mt7621-d-team_newifi-d2]çš„configæ–‡ä»¶å°±åœ¨[lede/target/linux/ramips/mt7621]ä¸­
   ## åœ¨æ–‡ä»¶ä»»æ„ä½ç½®æ·»åŠ ä»¥ä¸‹ä»£ç ï¼ˆå¯èƒ½ä¸æ­¢ä¸€ä¸ªconfig-xxxæ–‡ä»¶ï¼Œä¿é™©èµ·è§éƒ½åŠ ä¸Šï¼‰
   CONFIG_NETFILTER_NETLINK_GLUE_CT=y
   ## ç„¶åä¿å­˜å¹¶é€€å‡º
   
   # æ–¹æ³•äºŒï¼ˆæ—¶é—´è¾ƒé•¿ï¼Œè¦æœ‰è€å¿ƒï¼Œæ¨èæ–¹æ³•ä¸€ï¼‰
   ## åœ¨openwrtã€ledeæˆ–immortalwrtç›®å½•ä¸‹æ‰§è¡Œ
   make kernel_menuconfig
   ## ä¾æ¬¡é€‰ä¸­
   Networking support <*>
       --> Networking options
       	--> Network packet filtering framework (Netfilter) <*>
           	--> Core Netfilter Configuration
           		--> Netfilter NFNETLINK interface <*>
           		--> Netfilter LOG over NFNETLINK interface <*>
           		--> Netfilter connection tracking support <*>
           		--> Connection tracking netlink interface <*>
           		--> NFQUEUE and NFLOG integration with Connection Tracking <*>
   ## ç„¶åä¿å­˜å¹¶é€€å‡º
   
   # è¯´æ˜:
   # <M>:å•ç‹¬ç¼–è¯‘
   # <*>:ç¼–è¯‘è¿›å›ºä»¶
   ```

5. åŠ å…¥UA2Fæ¨¡å—

   ```bash
   git clone https://github.com/Zxilly/UA2F.git package/UA2F
   make menuconfig
   
   # åœ¨é…ç½®é¢æ¿ä¸­æŒ‰/æœç´¢ï¼Œå³å¯æ‰¾åˆ°
   # ä¸€èˆ¬åœ¨æ­¤ä½ç½®
   network
       --> Routing and Redirection
           --> UA2F <*>
           
   # ç„¶åä¿å­˜
   ```

6.  åŠ å…¥LuCI

    ```bash
    # æ‰¾åˆ°ä»¥ä¸‹æ¨¡å—å¹¶é€‰ä¸Š<*>
    LuCI
        --> 1. Collections
            --> luci <*>
        --> 2. Modules
            --> Translations
                --> Chinese Simplified (zh_Hans) <*>
        --> 3. Modules
            --> luci-compat <*>
            
    # ç„¶åä¿å­˜
    ```

7.  åŠ å…¥é˜² TTL æ£€æµ‹ä¾èµ–

    ```bash
    # æŒ‰ä¸‹/å¯æœç´¢ï¼Œæœç´¢iptables-mod-ipopt, kmod-ipt-ipopt
    # ä¸€èˆ¬åœ¨æ­¤ä½ç½®
    1.Network
        --> Firewall
            --> iptables-mod-ipopt <*>
    2.Kernel modules
        --> Netfilter Extensions
            --> kmod-ipt-ipopt <*>
            
    # ç„¶åä¿å­˜
    ```

8.  å…¶å®ƒä¾èµ–

    ```bash
    Network 
        --> 1.ipset <*>
        --> 2.Firewall
            --> iptables-mod-conntrack-extra <*>
            
    # ç„¶åä¿å­˜
    ```
    
9.  å®šåˆ¶å›ºä»¶

    ```bash
    è‡ªè¡Œå‹¾é€‰åŠ å…¥ä½ æƒ³è¦å®šåˆ¶çš„æ’ä»¶
            
    # ç„¶åä¿å­˜å¹¶é€€å‡º
    ```
    
9.  ä¸‹è½½ dl åº“

    ```bash
    make download -j8
    ```

10. ç¼–è¯‘å›ºä»¶ ï¼ˆ-j åé¢æ˜¯çº¿ç¨‹æ•°ï¼Œç¬¬ä¸€æ¬¡ç¼–è¯‘æ¨èç”¨å•çº¿ç¨‹ï¼‰

    ```bash
    # é WSL ä½¿ç”¨æ­¤å‘½ä»¤ç¼–è¯‘
    make V=s -j1
    # å¦‚æœä½ ä½¿ç”¨ WSL/WSL2 è¿›è¡Œç¼–è¯‘ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤
    PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin make -j$(($(nproc) + 1)) || PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin make -j1 V=s
    ```

11. ç¼–è¯‘å®Œæˆåè¾“å‡ºè·¯å¾„ï¼šbin/targetsï¼Œä¸€èˆ¬ä½¿ç”¨åŒ…å«squashfs-sysupgradeçš„å›ºä»¶ï¼Œå¦‚æœç¼–è¯‘å®Œåªæœ‰å†…æ ¸å›ºä»¶ï¼Œè¯´æ˜ä½ åŠ çš„æ¨¡å—å¤ªå¤šäº†ï¼Œä½“ç§¯è¶…è¿‡äº†å›ºä»¶çš„æœ€å¤§ä½“ç§¯

***

## äºŒæ¬¡ç¼–è¯‘

```bash
cd openwrt/lede/immortalwrt
git pull
./scripts/feeds update -a
./scripts/feeds install -a
make defconfig
make download -j8
make V=s -j$(nproc)
```

å¦‚æœéœ€è¦é‡æ–°é…ç½®ï¼š

```bash
rm -rf ./tmp && rm -rf .config
make menuconfig
make V=s -j$(nproc)
```

***

## macOS åŸç”Ÿç³»ç»Ÿè¿›è¡Œç¼–è¯‘

1.  åœ¨ AppStore ä¸­å®‰è£… Xcode

2.  å®‰è£… Homebrewï¼š

    ```bash
    /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
    ```

3.  ä½¿ç”¨ Homebrew å®‰è£…å·¥å…·é“¾ã€ä¾èµ–ä¸åŸºç¡€è½¯ä»¶åŒ…:

    ```bash
    brew unlink awk
    brew install coreutils diffutils findutils gawk gnu-getopt gnu-tar grep make ncurses pkg-config wget quilt xz
    brew install gcc@11
    ```

4.  ç„¶åè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œæ·»åŠ åˆ°ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­ï¼š

    ```bash
    echo 'export PATH="/usr/local/opt/coreutils/libexec/gnubin:$PATH"' >> ~/.bashrc
    echo 'export PATH="/usr/local/opt/findutils/libexec/gnubin:$PATH"' >> ~/.bashrc
    echo 'export PATH="/usr/local/opt/gnu-getopt/bin:$PATH"' >> ~/.bashrc
    echo 'export PATH="/usr/local/opt/gnu-tar/libexec/gnubin:$PATH"' >> ~/.bashrc
    echo 'export PATH="/usr/local/opt/grep/libexec/gnubin:$PATH"' >> ~/.bashrc
    echo 'export PATH="/usr/local/opt/gnu-sed/libexec/gnubin:$PATH"' >> ~/.bashrc
    echo 'export PATH="/usr/local/opt/make/libexec/gnubin:$PATH"' >> ~/.bashrc
    ```

5.  é‡æ–°åŠ è½½ä¸€ä¸‹ shell å¯åŠ¨æ–‡ä»¶ `source ~/.bashrc`ï¼Œç„¶åè¾“å…¥ `bash` è¿›å…¥ bash shellï¼Œå°±å¯ä»¥å’Œ Linux ä¸€æ ·æ­£å¸¸ç¼–è¯‘äº†

***

# è­¦å‘Š

*   ç¼–è¯‘çš„å›ºä»¶ç»å¯¹ä¸èƒ½åŒ…æ‹¬ä»»ä½•åé—¨æˆ–å¯ä»¥ç›‘æ§æˆ–è€…åŠ«æŒä½ çš„ HTTPS çš„é—­æºè½¯ä»¶ï¼Œ SSL å®‰å…¨æ˜¯äº’è”ç½‘æœ€åçš„å£å’ã€‚å®‰å…¨å¹²å‡€æ‰æ˜¯å›ºä»¶åº”è¯¥åšåˆ°çš„

*   ç¼–è¯‘çš„å›ºä»¶è¯·å¼€ä¸€ä¸ªæ–°æ–‡ä»¶å¤¹å­˜æ”¾ï¼Œå‘½åè§„åˆ™å–ç¼–è¯‘å®Œå›ºä»¶åç§°ä¸­`openwrt-`ã€`immortalwrt-`ä¸`-squashfs-sysupgrade.bin`ä¹‹é—´çš„å†…å®¹

*   ç¼–è¯‘çš„å›ºä»¶è¯·å¤‡æ³¨å¥½é»˜è®¤å¯†ç ï¼Œä»¥åŠé»˜è®¤è·¯ç”±å™¨ç®¡ç†åœ°å€ï¼Œå†™åœ¨æ–‡ä»¶å¤¹å•ç‹¬çš„`info.txt`ä¸­

*   è‹¥å›ºä»¶æœ‰ä»€ä¹ˆç‰¹æ®Šæƒ…å†µéœ€è¦è¯´æ˜ï¼Œè¯·åœ¨`info.txt`ä¸­è¯¦ç»†è¯´æ˜
